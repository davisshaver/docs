# Introduction

[Cay](https://github.com/coralproject/cay) is the front-end application for Coral.

It's made up of a series of [React](https://facebook.github.io/react/) components, compiled into modules with [webpack](http://webpack.github.io/).

The webpack build process results in a `bundle.js` file, which contains all Javascript and CSS for Cay. Common issues like CSS cross-browser issues, ES6 transpilation, and minification are all handled by webpack. `bundle.js` lives in-memory until build time (`npm run build`).

## Source code folder structure

```
.
+-- .github
+-- assets               -> nginx config
+-- css
+-- dist                 -> built files
+-- fonts
+-- lang
+-- public               -> images and config
   config.json           -> environment variables and such
   data_config.json      -> filters and dimension defs
+-- src
|  +-- app               -> top-level route views connected to Redux state
|    +-- layout
|    AppActions.js
|    AppReducer.js
|    MainReducer.js
     ... other page-level (stateful) components
|  +-- comments          -> any UI and redux for Comments
|  +-- components        -> re-usable generic UI components
|  +-- filters           -> any UI and redux for Filters
|  +-- flashmessages     -> any overlay messages for app status
|  +-- forms             -> most of the functionality for the Ask product
|  +-- i18n              -> internationalization wrappers
|  +-- search            -> any UI and redux for Searches
|  +-- services          -> initial setup of the app (styles, loading config, etc)
|  +-- tags              -> any UI and redux for Tags
|  +-- users             -> any UI and redux for Users
App.js                   -> routing setup
index.js                 -> entry point for app
settings.js              -> colors for the app
store.js                 -> redux store setup (also where auth is configured)

+-- test                 -> mirrors the src folder
```

The meat of the application lives in the `/src` folder. Components are grouped into subdirectories based on their "domain": for instance, everything that has to do with creating, viewing and editing searches lives in the `search` folder. Similarly, everything having to do with tags lives in the `tags` folder.

The reducers are combined in `/src/app/MainReducer.js`.

# Cay installation

### Installing from source

### Before you begin

Before you begin, be sure you have the following installed and running:

* [Xenia](../../xenia/#xenia-installation)
* [Pillar](../../pillar/#pillar-installation)
* [Coral Auth](https://github.com/coralproject/coral-auth)

In addition, you must have Node.js installed:

* [Node.js](https://nodejs.org/en/download/)
    * You must be running version 5.0.0 or higher of node. You can check your current version of node with the command `node --version`
    * We recommend using [nvm](https://www.npmjs.com/package/nvm) to manage your node installations.

### Get the source

Clone the Cay repository onto your machine:
```
git clone https://github.com/coralproject/cay.git
```
cd into the Cay directory:
```
cd cay
```
And perform an `npm install`:
```
npm install
```

### Set up configuration file

The folder called `public` has a sample configuration file, called `config.sample.json`. Copy this file to a new file called `config.json`, that you will edit:
```
cp public/config.sample.json public/config.json
```

Now, edit the config.json file.
```
{
  "xeniaHost": "",
  "pillarHost": "",
  "elkhornHost": "",
  "elkhornStaticHost": "",
  "environment": "development",
  "brand": "",
  "googleAnalyticsId": "UA-12345678-9",
  "requireLogin": false,
  "basicAuthorization": "",
  "authClientId": "some-client-id-setup-in-coral-auth",
  "authAuthority": "${auth_server}/connect",
  "features": {
    "trust": true,
    "ask": true
  }
}
```

Required edits:

* `xeniaHost`: The URL where Xenia is running.
    * If you installed Xenia [locally from source](../xenia/#xenia-installation), `xeniaHost` should be `http://localhost:4000/1.0/exec/`.
* `askHost`: The URL where the Shelf service is running.
    * If you installed Shelf [locally from source](../pillar/#install-pillar-from-source), `pillarHost` should be `http://localhost:8080`.
    * If you installed Shelf [locally as a Docker container](../pillar/#install-as-docker-container), `pillarHost` should be `http://10.0.4.105:8080`. `http://10.0.4.105` is the URL generated by Docker.
* `elkhornHost`: The URL where Elkhorn is running.
    * If you installed [locally from source](../elkhorn/#elkhorn-installation), `elkhornHost` should be `http://localhost:4444`.
* `features`: The fields in features allow to toggle the features for the different products on and off.
    * `trust`: When set to `true`, this will show Trust functionality (such as "Create a Search.") When set to `false`, it will hide Trust functionality. If this is not set, it will default to `true`.
    * `ask`: When set to `true`, this will show Ask functionality (such as "Create Form.") When set to `false`, it will hide Ask functionality.
* `authAuthority` this is the uri of the running auth server. e.g. `${server_host}/connect`
* `authClientId` this client id is the same string as what you setup in the `$ALLOWED_CLIENTS` variable in the coral-auth `.env` file.

Optional edits:

* `environment`:
* `brand`:
* `googleAnalyticsId`:
* `basicAuthorization`:


### Run the app

You can now start Cay by running npm start:
```
npm start
```
You can now visit Cay by visiting the URL [http://localhost:3000](http://localhost:3000).
