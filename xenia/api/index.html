<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>API and query management - Coral Project Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Coral Project Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../developer/">Introduction</a>
</li>

                    
                        
<li >
    <a href="../../developer/architectural_overview/">Architectural overview</a>
</li>

                    
                        
<li >
    <a href="../../quickstart/install/">Installing Coral Ecosystem</a>
</li>

                    
                        
<li >
    <a href="../../developer/developer_setup/">Developer tools setup</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cay</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cay/">Introduction</a>
</li>

        
            
<li >
    <a href="../../cay/install/">Installation</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Elkhorn</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../elkhorn/">Introduction</a>
</li>

        
            
<li >
    <a href="../../elkhorn/install/">Installation</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Pillar</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../pillar/">Introduction</a>
</li>

        
            
<li >
    <a href="../../pillar/install/">Installation</a>
</li>

        
            
<li >
    <a href="../../pillar/api/">API</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Sponge</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../sponge/">Introduction</a>
</li>

        
            
<li >
    <a href="../../sponge/install/">Installation</a>
</li>

        
            
<li >
    <a href="../../sponge/included_packages/">Included packages</a>
</li>

        
            
<li >
    <a href="../../sponge/strategy/">Strategy files</a>
</li>

        
            
<li >
    <a href="../../sponge/logging/">Logging</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Xenia</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../">Introduction</a>
</li>

        
            
<li >
    <a href="../install/">Installation</a>
</li>

        
            
<li class="active">
    <a href="./">API and query management</a>
</li>

        
            
<li >
    <a href="../tests/">Testing</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Xenia Driver</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../xenia-driver-js/">Introduction</a>
</li>

        
            
<li >
    <a href="../xenia-driver-js-install/">Installation</a>
</li>

        
            
<li >
    <a href="../xenia-driver-js-api/">API</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../user/">Introduction</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Trust</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../user/trust/">Overview</a>
</li>

        
            
<li >
    <a href="../../user/trust_tutorials/">Tutorials</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Ask</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../user/ask/">Overview</a>
</li>

        
            
<li >
    <a href="../../user/ask_tutorials/">Tutorials</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Talk</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../user/talk/">Overview</a>
</li>

        
            
<li >
    <a href="../../user/talk_tutorials/">Tutorials</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../contribute/">Introduction</a>
</li>

                    
                        
<li >
    <a href="../../contribute/documentation/writing_documentation/">Writing documentation</a>
</li>

                    
                        
<li >
    <a href="../../contribute/documentation/style_guide/">Documentation style guide</a>
</li>

                    
                        
<li >
    <a href="../../contribute/reporting_bugs/">Reporting bugs and requesting features</a>
</li>

                    
                        
<li >
    <a href="../../contribute/development/writing_code/">Writing code</a>
</li>

                    
                        
<li >
    <a href="../../contribute/development/working_with_github/">Development workflow</a>
</li>

                    
                        
<li >
    <a href="../../contribute/development/style_guide/">Coding style guide</a>
</li>

                    
                        
<li >
    <a href="../../contribute/supporting_the_community/">Supporting the community</a>
</li>

                    
                        
<li >
    <a href="../../contribute/contributor_license_agreement/">Contributor License Agreement</a>
</li>

                    
                        
<li >
    <a href="../../contribute/coral_naming/">Coral naming</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../faq/">FAQ</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../install/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../tests/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#xenia-api">Xenia API</a></li>
        
            <li><a href="#endpoints">Endpoints</a></li>
        
            <li><a href="#query-management-with-the-command-line-tool">Query management with the command line tool</a></li>
        
            <li><a href="#writing-sets">Writing Sets</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="xenia-api">Xenia API</h1>
<p><strong>This section is under construction, and is not currently complete.</strong></p>
<h2 id="endpoints">Endpoints</h2>
<p>If you set the authorization header properly in your browser (TODO) you can run the following endpoints.</p>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">HTTP Verb</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/1.0/query</td>
<td align="left">GET</td>
<td align="left"><a href="#get-a-list-of-configured-queries">Get a list of configured queries</a></td>
</tr>
<tr>
<td align="left">/1.0/query/basic</td>
<td align="left">GET</td>
<td align="left"><a href="#import-asset">Get the query set document for the <code>basic</code> query set</a></td>
</tr>
<tr>
<td align="left">/1.0/exec/basic</td>
<td align="left">GET</td>
<td align="left"><a href="#import-comment">Execute the query for the <code>basic</code> query set</a></td>
</tr>
<tr>
<td align="left">/1.0/exec/basic_var</td>
<td align="left">GET</td>
<td align="left"><a href="#import-note">Execute the query for the <code>basic_var</code> query set with variables</a></td>
</tr>
<tr>
<td align="left">/1.0/exec</td>
<td align="left">POST</td>
<td align="left"><a href="#import-user">Execute a dynamic query set</a></td>
</tr>
</tbody>
</table>
<h3 id="get-a-list-of-configured-queries">Get a list of configured queries</h3>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">HTTP Verb</th>
<th align="left">Functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/1.0/query</td>
<td align="left">GET</td>
<td align="left">Get a list of configured queries</td>
</tr>
</tbody>
</table>
<h4 id="parameters">Parameters</h4>
<p>None</p>
<h4 id="example-call">Example call</h4>
<pre><code>GET
http://localhost:4000/1.0/query
</code></pre>

<h4 id="example-response">Example response</h4>
<pre><code>[&quot;basic&quot;,&quot;basic_var&quot;,&quot;top_commenters_by_count&quot;]
</code></pre>

<h3 id="get-the-query-set-document-for-the-basic-query-set">Get the query set document for the <code>basic</code> query set</h3>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">HTTP Verb</th>
<th align="left">Functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/1.0/query/basic</td>
<td align="left">GET</td>
<td align="left">Get the query set document for the <code>basic</code> query set</td>
</tr>
</tbody>
</table>
<h4 id="parameters_1">Parameters</h4>
<p>None</p>
<h4 id="example-call_1">Example call</h4>
<pre><code>GET
http://localhost:4000/1.0/query/basic
</code></pre>

<h4 id="example-response_1">Example response</h4>
<pre><code>{
   &quot;name&quot;:&quot;QTEST_basic&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Basic&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;42021&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      }
   ]
}
</code></pre>

<h3 id="execute-the-query-for-the-basic-query-set">Execute the query for the <code>basic</code> query set</h3>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">HTTP Verb</th>
<th align="left">Functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/1.0/query</td>
<td align="left">GET</td>
<td align="left">Execute the query for the basic query set</td>
</tr>
</tbody>
</table>
<h4 id="parameters_2">Parameters</h4>
<p>None</p>
<h4 id="example-call_2">Example call</h4>
<pre><code>GET
http://localhost:4000/1.0/exec/basic
</code></pre>

<pre><code>set:

{
   &quot;name&quot;:&quot;basic&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Basic&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;42021&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      }
   ]
}
</code></pre>

<h4 id="example-response_2">Example response</h4>
<pre><code>{
  &quot;results&quot;:[
    {
      &quot;Name&quot;:&quot;basic&quot;,
      &quot;Docs&quot;:[
        {
          &quot;name&quot;:&quot;C14 - Pasco County Buoy, FL&quot;
        }
      ]
    }
  ],
  &quot;error&quot;:false
}
</code></pre>

<h3 id="execute-the-query-for-the-basic_var-query-set-with-variables">Execute the query for the <code>basic_var</code> query set with variables</h3>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">HTTP Verb</th>
<th align="left">Functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/1.0/exec/basic_var</td>
<td align="left">GET</td>
<td align="left">Execute the query for the <code>basic_var</code> query set with variables</td>
</tr>
</tbody>
</table>
<h4 id="parameters_3">Parameters</h4>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Required?</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">station_id</td>
<td align="left">Y</td>
<td align="left">Tag ID</td>
</tr>
</tbody>
</table>
<pre><code>GET
http://localhost:4000/1.0/exec/basic_var?station_id=42021

set:

{
   &quot;name&quot;:&quot;basic_var&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;BasicVar&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;#string:station_id&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      }
   ]
}

output:

{
  &quot;results&quot;:[
    {
      &quot;Name&quot;:&quot;basic_var&quot;,
      &quot;Docs&quot;:[
        {
          &quot;name&quot;:&quot;C14 - Pasco County Buoy, FL&quot;
        }
      ]
    }
  ],
  &quot;error&quot;:false
}
</code></pre>

<p>5) You can execute a dynamic query set:</p>
<pre><code>POST
http://localhost:4000/1.0/exec

Post Data:
{
   &quot;name&quot;:&quot;basic&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Basic&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;42021&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      }
   ]
}
</code></pre>

<h2 id="query-management-with-the-command-line-tool">Query management with the command line tool</h2>
<p>Using the Xenia command line tool you can manage query sets.</p>
<pre><code>cd $GOPATH/src/github.com/coralproject/xenia/cmd/xenia
</code></pre>

<h4 id="get-a-list-of-saved-queries">Get a list of saved queries:</h4>
<pre><code>./xenia query list

output:

basic
basic_var
top_commenters_by_count
</code></pre>

<h4 id="look-at-the-details-of-a-query">Look at the details of a query:</h4>
<pre><code>./xenia query get -n basic

output:

{
   &quot;name&quot;:&quot;basic&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Basic&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;42021&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      }
   ]
}
</code></pre>

<h4 id="execute-a-query">Execute a query:</h4>
<pre><code>./xenia query exec -n basic

output:

{
  &quot;results&quot;:[
    {
      &quot;Name&quot;:&quot;basic&quot;,
      &quot;Docs&quot;:[
        {
          &quot;name&quot;:&quot;C14 - Pasco County Buoy, FL&quot;
        }
      ]
    }
  ],
  &quot;error&quot;:false
}
</code></pre>

<h4 id="add-or-update-a-query-for-use">Add or update a query for use:</h4>
<pre><code>./xenia query upsert -p ./scrquery/basic_var.json

output:

Upserting Query : Path[./scrquery/basic_var.json]
</code></pre>

<p>By convention, we store core query scripts in the <a href="https://github.com/CoralProject/xenia/tree/master/cmd/xenia/scrquery">/xenia/cmd/xenia/scrquery</a> folder.  As we develop Coral features, store the JSON files there so other developers can use them (eventually, groups of query sets will be refactored to another location, but that&rsquo;s the right folder for the time being).</p>
<pre><code>cd $GOPATH/src/github.com/coralproject/xenia/cmd/xenia/scrquery
ls
</code></pre>

<h4 id="direct-mongo-access-optional">Direct Mongo access (optional)</h4>
<p>You can look in the db at existing queries:</p>
<pre><code>mongo [flags to connect to your server]
use coral (or your databasename)
db.query_sets.find()
</code></pre>

<h2 id="writing-sets">Writing Sets</h2>
<p>&ldquo;Writing a set&rdquo; is essentially about creating a MongoDB aggregation pipeline. Xenia has built on top of this by providing extended functionality to make MongoDB more powerful.</p>
<p>Here is a multi query set with variable substitution and date processing:</p>
<pre><code>GET
http://localhost:4000/1.0/exec/basic?station_id=42021

{
   &quot;name&quot;:&quot;basic&quot;,
   &quot;desc&quot;:&quot;Shows a basic multi result query.&quot;,
   &quot;enabled&quot;:true,
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Basic&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_bill&quot;,
         &quot;return&quot;:true,
         &quot;scripts&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : &quot;#station_id#&quot;}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}}
         ]
      },
      {
         &quot;name&quot;:&quot;Time&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_bill&quot;,
         &quot;return&quot;:true,
         &quot;scripts&quot;:[
            {&quot;$match&quot;: {&quot;condition.date&quot; : {&quot;$gt&quot;: &quot;#date:2013-01-01T00:00:00.000Z&quot;}}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}},
            {&quot;$limit&quot;: 2}
         ]
      }
   ]
}
</code></pre>

<p>Here is the list of commands that exist for variable substitution.</p>
<pre><code>{&quot;field&quot;: &quot;#cmd:variable&quot;}

// Basic commands.
Before: {&quot;field&quot;: &quot;#number:variable_name&quot;}      After: {&quot;field&quot;: 1234}
Before: {&quot;field&quot;: &quot;#string:variable_name&quot;}      After: {&quot;field&quot;: &quot;value&quot;}
Before: {&quot;field&quot;: &quot;#date:variable_name&quot;}        After: {&quot;field&quot;: time.Time}
Before: {&quot;field&quot;: &quot;#objid:variable_name&quot;}       After: {&quot;field&quot;: mgo.ObjectId}
Before: {&quot;field&quot;: &quot;#regex:/pattern/{options}&quot;}  After: {&quot;field&quot;: bson.RegEx}

// data command can index into saved results.
Before: {&quot;field&quot; : {&quot;$in&quot;: &quot;#data.*:list.station_id&quot;}}}   After: [{&quot;station_id&quot;:&quot;42021&quot;}]
Before: {&quot;field&quot;: &quot;#data.0:doc.station_id&quot;}               After: {&quot;field&quot;: &quot;23453&quot;}

// time command manipulates the current time.
Before: {&quot;field&quot;: #time:0}                 After: {&quot;field&quot;: time.Time(Current Time)}
Before: {&quot;field&quot;: #time:-3600}             After: {&quot;field&quot;: time.Time(3600 seconds in the past)}
Before: {&quot;field&quot;: #time:3m}                After: {&quot;field&quot;: time.Time(3 minutes in the future)}

Possible duration types. Default is seconds if not provided.
&quot;ns&quot;: Nanosecond
&quot;us&quot;: Microsecond
&quot;ms&quot;: Millisecond
&quot;s&quot; : Second
&quot;m&quot; : Minute
&quot;h&quot; : Hour
</code></pre>

<p>You can save the result of one query for later use by the next.</p>
<pre><code>GET
http://localhost:4000/1.0/exec/basic_save

{
   &quot;name&quot;:&quot;basic_save&quot;,
   &quot;desc&quot;:&quot;&quot;,
   &quot;enabled&quot;:true,
   &quot;params&quot;:[],
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;get_id_list&quot;,
         &quot;desc&quot;: &quot;Get the list of id's&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:false,
         &quot;commands&quot;:[
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;station_id&quot;: 1}},
            {&quot;$limit&quot;: 5}
            {&quot;$save&quot;: {&quot;$map&quot;: &quot;list&quot;}}
         ]
      },
      {
         &quot;name&quot;:&quot;retrieve_stations&quot;,
         &quot;desc&quot;: &quot;Retrieve the list of stations&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_xenia_data&quot;,
         &quot;return&quot;:true,
         &quot;commands&quot;:[
            {&quot;$match&quot;: {&quot;station_id&quot; : {&quot;$in&quot;: &quot;#data.*:list.station_id&quot;}}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}},
         ]
      }
   ]
}
</code></pre>

<p>The <code>$save</code> command is an Xenia extension and currently only <code>$map</code> is supported.</p>
<pre><code>{&quot;$save&quot;: {&quot;$map&quot;: &quot;list&quot;}}
</code></pre>

<p>The result will be saved in a map under the name <code>list</code>.</p>
<p>The second query is using the <code>#data</code> command. The data command has two options. Use can use <code>#data.*</code> or <code>#data.Idx</code>.</p>
<p>Use the <code>*</code> operator when you need an array. In this example we need to support an <code>$in</code> command:</p>
<pre><code>{
   &quot;name&quot;:&quot;retrieve_stations&quot;,
   &quot;desc&quot;: &quot;Retrieve the list of stations&quot;,
   &quot;type&quot;:&quot;pipeline&quot;,
   &quot;collection&quot;:&quot;test_xenia_data&quot;,
   &quot;return&quot;:true,
   &quot;commands&quot;:[
      {&quot;$match&quot;: {&quot;station_id&quot; : {&quot;$in&quot;: &quot;#data.*:list.station_id&quot;}}},
      {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}},
   ]
}

When you need an array to be substituted.
Before: {&quot;field&quot; : {&quot;$in&quot;: &quot;#data.*:list.station_id&quot;}}}
After : {&quot;field&quot; : {&quot;$in&quot;: [&quot;42021&quot;]}}
    dataOp : &quot;*&quot;
    lookup : &quot;list.station_id&quot;
    results: {&quot;list&quot;: [{&quot;station_id&quot;:&quot;42021&quot;}]}
</code></pre>

<p>Use the index operator when you need a single value. Specify which document in the array of documents you want to select:</p>
<pre><code>
{
   &quot;name&quot;:&quot;retrieve_stations&quot;,
   &quot;desc&quot;: &quot;Retrieve the list of stations&quot;,
   &quot;type&quot;:&quot;pipeline&quot;,
   &quot;collection&quot;:&quot;test_xenia_data&quot;,
   &quot;return&quot;:true,
   &quot;commands&quot;:[
      {&quot;$match&quot;: {&quot;station_id&quot; : &quot;#data.0:list.station_id&quot;}},
      {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}},
   ]
}

When you need a single value to be substituted, select an index.
Before: {&quot;field&quot; : &quot;#data.0:list.station_id&quot;}
After : {&quot;field&quot; : &quot;42021&quot;}
    dataOp : 0
    lookup : &quot;list.station_id&quot;
    results: {&quot;list&quot;: [{&quot;station_id&quot;:&quot;42021&quot;}, {&quot;station_id&quot;:&quot;23567&quot;}]}
</code></pre>

<p>You can also replace field names in the query commands.</p>
<pre><code>Variables
{
  &quot;cond&quot;: &quot;condition&quot;,
  &quot;dt&quot;: &quot;date&quot;
}

Query Set
{
   &quot;name&quot;:&quot;basic&quot;,
   &quot;desc&quot;:&quot;Shows field substitution.&quot;,
   &quot;enabled&quot;:true,
   &quot;queries&quot;:[
      {
         &quot;name&quot;:&quot;Time&quot;,
         &quot;type&quot;:&quot;pipeline&quot;,
         &quot;collection&quot;:&quot;test_bill&quot;,
         &quot;return&quot;:true,
         &quot;scripts&quot;:[
            {&quot;$match&quot;: {&quot;{cond}.{dt}&quot; : {&quot;$gt&quot;: &quot;#date:2013-01-01T00:00:00.000Z&quot;}}},
            {&quot;$project&quot;: {&quot;_id&quot;: 0, &quot;name&quot;: 1}},
            {&quot;$limit&quot;: 2}
         ]
      }
   ]
}
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>